
<html>
		<head>
			<title>--- Web Product Configurator ---</title>
			<style>
			body {
				font-family: Monospace;
				background-color:#f0f0f0;
				margin: 0px;
				overflow: hidden;
			}
			canvas {
				width: 100%;
				height: 100%;
			}
		</style>
			<script src="libs/three.js"></script>
			<script src="libs/stats.min.js"></script>
			<script src="libs/OBJLoader.js"></script>
			<script src="libs/Coordinates.js"></script>
            <script src="libs/OrbitControls.js"></script>
            <script src="libs/GLTFLoader.js"></script>
		</head>
		-------------- Andrea Mansi UNIUD --- Progetto Interactive 3D Graphics --- Web Product Configurator ---
		<body>

            <script type="text/x-glsl" id="BasicVertexShader">
                varying vec3 color;
				
				void main() {
					vec3 newPosition = position;
					// transforms the vertex from object space to clip space coords		
                    gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );
                }
			</script>
		
			<script type="text/x-glsl" id="BasicColorFragmentShader">
				varying vec3 color;
				void main() {
					gl_FragColor = vec4(0.5,0.5,0.5,1.0);
				}
            </script>

            <script type="text/x-glsl" id="BasicColorFragmentShaderTEST">
				varying vec3 color;
				void main() {
					gl_FragColor = vec4(0.9,0.1,0.1,1.0);
				}
            </script>
	
			<script>
				// VARIABLES //
				var scene, camera, renderer, camera, stats;
                var ambientLight;   //scene ambient light object
                var modelParts;     // contains model's meshes
                var modelMaterials; // contains starting model's materials for each mesh (material of index x is the x part's material)
                var numberOfParts = 2;
                var modeLoaded = false;

                // Shaders //
                var basicVertex;
                var basicFragment;
                var basicFragmentTest;

				
				function Start() {
                    // Starting configuration phase:
                    // 1. Model meshes loading phase
                    modelParts = new Array(numberOfParts);
                    modelMaterials = new Array(numberOfParts);
                    loadGLTFModel();
                    loadShaders();

                    // 2. Scene Initialization phase
					setupScene();
					setupCamera();
					setupRenderer();
					setupStatsOSD();
					setupBasicLightSystem();
					spawnFloor(500,0.2,500,-5);	//spawns a basic floor on the scene

					/* ___________________________________________________________________________________________________________________________________________________________________________
					>> Start code goes here:
					*/


	
				}


                function createMaterial(uniforms,vertexShader,fragmentShader){
                    newMaterial = new THREE.ShaderMaterial({
                        uniforms: uniforms,
                        vertexShader: vertexShader,
                        fragmentShader: fragmentShader });
                    return newMaterial;
                }

                function changePartMaterial(part,material){
                    part.material = material;
                }

                function loadGLTFModel(){
                    var loader = new THREE.GLTFLoader();
                    loader.load(
                       "test2.glb",
                       function ( gltf ) {
                       console.log(gltf.scene);
                       modelParts[0] = gltf.scene.children[0]; 
                       modelParts[1] = gltf.scene.children[1];
                       scene.add(modelParts[0]);
                       scene.add(modelParts[1]);

                       var uniforms = {
                       };
                    
                       modelMaterials[0] = new createMaterial(uniforms,basicVertex,basicFragmentTest); 
                       modelMaterials[1] = new createMaterial(uniforms,basicVertex,basicFragment); 

                       modelParts[0].material = modelMaterials[0];
                       modelParts[1].material = modelMaterials[1];

                       modeLoaded = true;

                       },)
                       ;
                    
                }

                function loadShaders(){
                    basicVertex = document.getElementById("BasicVertexShader").textContent;
                    basicFragment = document.getElementById("BasicColorFragmentShader").textContent;
                    basicFragmentTest = document.getElementById("BasicColorFragmentShaderTEST").textContent;
                }
				
				function Update() {	
					requestAnimationFrame(Update);
					stats.update();
					controls.update();
					renderer.render(scene, camera);
				}
	
				function setupScene(){	// SCENE //
					scene = new THREE.Scene();
					Coordinates.drawAllAxes();
				}
	
				function setupCamera(){	 // CAMERA //
					camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
					camera.position.set(10,10,10);
					camera.lookAt( new THREE.Vector3(0,0,0));
					controls = new THREE.OrbitControls(camera);
				}
	
				function setupRenderer(){	// RENDERER //
					renderer = new THREE.WebGLRenderer({antialias:true});
					renderer.setSize( window.innerWidth, window.innerHeight );
					renderer.setClearColor(0xf0f0f0);
					renderer.shadowMap.Type = THREE.PCFShadowMap;
					document.body.appendChild( renderer.domElement);
					renderer.shadowMap.enabled = true;
					renderer.shadowMap.type = THREE.BasicShadowMap;
				}
	
				function setupStatsOSD(){	// STATISTICS OSD //
					stats = new Stats();
					stats.domElement.style.position = 'absolute';
					stats.domElement.style.top = '0px';
					document.body.appendChild( stats.domElement );
				}
	
				function setupBasicLightSystem(){	// ADD A BASIC LIGHT SYSTEM TO THE SCENE //
					// basic ambient light
					ambientLight = new THREE.AmbientLight(0xffffff,0.3); 
					scene.add(ambientLight);

					/*	NOT USED 
					// basic point light
					plight = new THREE.PointLight(0xffffff,2.9,21);
					plight.castShadow = true;
					plight.shadow.camera.near = 0.2;
					plight.shadow.camera.far = 25;
					scene.add(plight);
					plight.position.y = 10;
					plight.shadow.mapSize.width = 2048;
					plight.shadow.mapSize.height = 2048;

					*/
				}
	
				function spawnFloor(larghezza,altezza,profondità,pos_y){
					var geometry1 = new THREE.CubeGeometry(larghezza,altezza,profondità);
					var material1 = new THREE.MeshPhongMaterial( { color:0xffffff } );
					var floor = new THREE.Mesh( geometry1, material1 );
					floor.receiveShadow = true;
					scene.add(floor);
					floor.position.y = pos_y;
				}
	
				// ___________________________________________________________________________________________________________________________________________________________________________
				// Main code goes here:
	
				Start();
				Update();
				
			</script>
		</body>
	</html>